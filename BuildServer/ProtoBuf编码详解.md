# ProtoBuf (Protocol Buffers) ç¼–ç è¯¦è§£

## ğŸ“š ç›®å½•

1. [ProtoBuf ç®€ä»‹](#protobuf-ç®€ä»‹)
2. [æ¶ˆæ¯ç»“æ„](#æ¶ˆæ¯ç»“æ„)
3. [å­—æ®µç¼–ç ](#å­—æ®µç¼–ç )
4. [Wire Typesï¼ˆçº¿ç±»å‹ï¼‰](#wire-typesçº¿ç±»å‹)
5. [Varint ç¼–ç ](#varint-ç¼–ç )
6. [å­—æ®µæ ‡è®°ï¼ˆField Tagï¼‰](#å­—æ®µæ ‡è®°field-tag)
7. [å„ç§æ•°æ®ç±»å‹çš„ç¼–ç ](#å„ç§æ•°æ®ç±»å‹çš„ç¼–ç )
8. [é•¿åº¦å‰ç¼€ç¼–ç ](#é•¿åº¦å‰ç¼€ç¼–ç )
9. [å®é™…ç¼–ç ç¤ºä¾‹](#å®é™…ç¼–ç ç¤ºä¾‹)
10. [ç¼–ç è§„åˆ™æ€»ç»“](#ç¼–ç è§„åˆ™æ€»ç»“)

---

## ProtoBuf ç®€ä»‹

Protocol Buffersï¼ˆç®€ç§° ProtoBufï¼‰æ˜¯ Google å¼€å‘çš„ä¸€ç§æ•°æ®åºåˆ—åŒ–æ ¼å¼ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- **ç´§å‡‘**ï¼šæ¯” XMLã€JSON æ›´å°
- **å¿«é€Ÿ**ï¼šåºåˆ—åŒ–/ååºåˆ—åŒ–é€Ÿåº¦å¿«
- **è·¨è¯­è¨€**ï¼šæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€
- **å‘åå…¼å®¹**ï¼šå¯ä»¥æ·»åŠ æ–°å­—æ®µè€Œä¸ç ´åæ—§ä»£ç 

---

## æ¶ˆæ¯ç»“æ„

### åŸºæœ¬æ¦‚å¿µ

ProtoBuf æ¶ˆæ¯ç”±å¤šä¸ª**å­—æ®µï¼ˆFieldï¼‰**ç»„æˆï¼Œæ¯ä¸ªå­—æ®µåŒ…å«ï¼š
- **å­—æ®µå·ï¼ˆField Numberï¼‰**ï¼šå”¯ä¸€æ ‡è¯†å­—æ®µ
- **å­—æ®µç±»å‹ï¼ˆWire Typeï¼‰**ï¼šæ•°æ®çš„ç¼–ç æ–¹å¼
- **å­—æ®µå€¼ï¼ˆValueï¼‰**ï¼šå®é™…çš„æ•°æ®

### å­—æ®µå®šä¹‰

```protobuf
message Person {
    int32 id = 1;        // å­—æ®µå·1ï¼Œç±»å‹int32
    string name = 2;     // å­—æ®µå·2ï¼Œç±»å‹string
    int32 age = 3;       // å­—æ®µå·3ï¼Œç±»å‹int32
}
```

---

## å­—æ®µç¼–ç 

### å­—æ®µæ ‡è®°ï¼ˆField Tagï¼‰

æ¯ä¸ªå­—æ®µåœ¨ç¼–ç æ—¶ï¼Œé¦–å…ˆå†™å…¥ä¸€ä¸ª**å­—æ®µæ ‡è®°**ï¼Œæ ¼å¼ä¸ºï¼š

```
å­—æ®µæ ‡è®° = (å­—æ®µå· << 3) | WireType
```

**å­—æ®µæ ‡è®°ä½¿ç”¨ Varint ç¼–ç **ï¼ˆè§ä¸‹æ–‡ï¼‰

### å­—æ®µæ ‡è®°æ ¼å¼

```
å­—æ®µæ ‡è®°å­—èŠ‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­—æ®µå·  â”‚ WireTypeâ”‚
â”‚ (5ä½)   â”‚ (3ä½)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **é«˜5ä½**ï¼šå­—æ®µå·ï¼ˆField Numberï¼Œ1-536870911ï¼‰
- **ä½3ä½**ï¼šWire Typeï¼ˆ0-7ï¼‰

---

## Wire Typesï¼ˆçº¿ç±»å‹ï¼‰

ProtoBuf å®šä¹‰äº†ä»¥ä¸‹ Wire Typesï¼š

| Wire Type | åç§° | ç”¨é€” | ç¤ºä¾‹ç±»å‹ |
|-----------|------|------|----------|
| 0 | Varint | å˜é•¿æ•´æ•° | int32, int64, uint32, uint64, sint32, sint64, bool, enum |
| 1 | Fixed64 | å›ºå®š64ä½ | double, fixed64, sfixed64 |
| 2 | Length-Delimited | é•¿åº¦å‰ç¼€ | string, bytes, embedded messages, packed repeated fields |
| 3 | Start Group | ç»„å¼€å§‹ï¼ˆå·²åºŸå¼ƒï¼‰ | groups (deprecated) |
| 4 | End Group | ç»„ç»“æŸï¼ˆå·²åºŸå¼ƒï¼‰ | groups (deprecated) |
| 5 | Fixed32 | å›ºå®š32ä½ | float, fixed32, sfixed32 |

---

## Varint ç¼–ç 

### åŸç†

Varint æ˜¯ä¸€ç§å˜é•¿æ•´æ•°ç¼–ç ï¼Œä½¿ç”¨**7ä½å­˜å‚¨æ•°æ®ï¼Œ1ä½ä½œä¸ºç»§ç»­æ ‡å¿—**ã€‚

### ç¼–ç è§„åˆ™

1. å°†æ•´æ•°æŒ‰7ä½åˆ†ç»„
2. æ¯ä¸ªå­—èŠ‚çš„ä½7ä½å­˜å‚¨æ•°æ®
3. æœ€é«˜ä½ï¼ˆMSBï¼‰è¡¨ç¤ºæ˜¯å¦è¿˜æœ‰åç»­å­—èŠ‚ï¼š
   - `0`ï¼šè¿™æ˜¯æœ€åä¸€ä¸ªå­—èŠ‚
   - `1`ï¼šè¿˜æœ‰åç»­å­—èŠ‚

### ç¼–ç ç¤ºä¾‹

#### ç¤ºä¾‹1ï¼šå°æ•´æ•°ï¼ˆâ‰¤127ï¼‰

```
å€¼ï¼š1
äºŒè¿›åˆ¶ï¼š00000001
Varintç¼–ç ï¼š00000001 (1å­—èŠ‚)
åå…­è¿›åˆ¶ï¼š01
```

#### ç¤ºä¾‹2ï¼šä¸­ç­‰æ•´æ•°ï¼ˆ128-16383ï¼‰

```
å€¼ï¼š300
äºŒè¿›åˆ¶ï¼š00000001 00101100
åˆ†ç»„ï¼š
  å­—èŠ‚1ï¼š00000010 (2) + ç»§ç»­æ ‡å¿—(1) = 10000010
  å­—èŠ‚2ï¼š00101100 (44) + ç»“æŸæ ‡å¿—(0) = 00101100
Varintç¼–ç ï¼š10000010 00101100 (2å­—èŠ‚)
åå…­è¿›åˆ¶ï¼šAC 02
```

**æ³¨æ„**ï¼šVarint ä½¿ç”¨**å°ç«¯åº**ï¼ˆLittle-Endianï¼‰ï¼Œä½å­—èŠ‚åœ¨å‰ã€‚

#### ç¤ºä¾‹3ï¼šå¤§æ•´æ•°

```
å€¼ï¼š150
äºŒè¿›åˆ¶ï¼š10010110
åˆ†ç»„ï¼š
  å­—èŠ‚1ï¼š10010110 (150) + ç»§ç»­æ ‡å¿—(1) = 10010110
  å­—èŠ‚2ï¼š00000001 (1) + ç»“æŸæ ‡å¿—(0) = 00000001
Varintç¼–ç ï¼š10010110 00000001 (2å­—èŠ‚)
åå…­è¿›åˆ¶ï¼š96 01
```

### Varint ç¼–ç è¡¨ï¼ˆå¸¸è§å€¼ï¼‰

| å€¼ | Varintç¼–ç ï¼ˆåå…­è¿›åˆ¶ï¼‰ | è¯´æ˜ |
|----|----------------------|------|
| 0 | `00` | 1å­—èŠ‚ |
| 1 | `01` | 1å­—èŠ‚ |
| 127 | `7F` | 1å­—èŠ‚ï¼ˆæœ€å¤§å€¼ï¼‰ |
| 128 | `80 01` | 2å­—èŠ‚ |
| 300 | `AC 02` | 2å­—èŠ‚ |
| 150 | `96 01` | 2å­—èŠ‚ |
| 16383 | `FF 7F` | 2å­—èŠ‚ï¼ˆæœ€å¤§å€¼ï¼‰ |
| 16384 | `80 80 01` | 3å­—èŠ‚ |

---

## å­—æ®µæ ‡è®°ï¼ˆField Tagï¼‰

### è®¡ç®—æ–¹å¼

```
å­—æ®µæ ‡è®° = (å­—æ®µå· << 3) | WireType
```

### ç¤ºä¾‹

#### ç¤ºä¾‹1ï¼šå­—æ®µå·1ï¼ŒWireType=0ï¼ˆVarintï¼‰

```
å­—æ®µå·ï¼š1
WireTypeï¼š0
å­—æ®µæ ‡è®° = (1 << 3) | 0 = 8 | 0 = 8 (0x08)
```

#### ç¤ºä¾‹2ï¼šå­—æ®µå·2ï¼ŒWireType=0ï¼ˆVarintï¼‰

```
å­—æ®µå·ï¼š2
WireTypeï¼š0
å­—æ®µæ ‡è®° = (2 << 3) | 0 = 16 | 0 = 16 (0x10)
```

#### ç¤ºä¾‹3ï¼šå­—æ®µå·1ï¼ŒWireType=2ï¼ˆLength-Delimitedï¼‰

```
å­—æ®µå·ï¼š1
WireTypeï¼š2
å­—æ®µæ ‡è®° = (1 << 3) | 2 = 8 | 2 = 10 (0x0A)
```

### å­—æ®µæ ‡è®°è¡¨ï¼ˆå¸¸ç”¨ï¼‰

| å­—æ®µå· | WireType | å­—æ®µæ ‡è®°ï¼ˆåå…­è¿›åˆ¶ï¼‰ | è¯´æ˜ |
|--------|----------|---------------------|------|
| 1 | 0 (Varint) | `08` | int32, int64, boolç­‰ |
| 1 | 2 (Length) | `0A` | string, bytes, message |
| 2 | 0 (Varint) | `10` | int32, int64, boolç­‰ |
| 2 | 2 (Length) | `12` | string, bytes, message |
| 3 | 0 (Varint) | `18` | int32, int64, boolç­‰ |
| 3 | 2 (Length) | `1A` | string, bytes, message |

---

## å„ç§æ•°æ®ç±»å‹çš„ç¼–ç 

### 1. int32 / int64 / uint32 / uint64

**Wire Typeï¼š0ï¼ˆVarintï¼‰**

```
ç¼–ç æ ¼å¼ï¼š[å­—æ®µæ ‡è®°] [Varintç¼–ç çš„å€¼]
```

**ç¤ºä¾‹ï¼š**

```
å­—æ®µå®šä¹‰ï¼šint32 id = 1;
å€¼ï¼š1

ç¼–ç ï¼š
  å­—æ®µæ ‡è®°ï¼š08 (å­—æ®µ1, WireType=0)
  å€¼ï¼š01 (Varintç¼–ç çš„1)
  ç»“æœï¼š08 01
```

```
å­—æ®µå®šä¹‰ï¼šint32 id = 1;
å€¼ï¼š300

ç¼–ç ï¼š
  å­—æ®µæ ‡è®°ï¼š08 (å­—æ®µ1, WireType=0)
  å€¼ï¼šAC 02 (Varintç¼–ç çš„300)
  ç»“æœï¼š08 AC 02
```

### 2. sint32 / sint64ï¼ˆæœ‰ç¬¦å·æ•´æ•°ä¼˜åŒ–ï¼‰

**Wire Typeï¼š0ï¼ˆVarintï¼‰**

ä½¿ç”¨ **ZigZag ç¼–ç **ä¼˜åŒ–è´Ÿæ•°ï¼š

```
ZigZagç¼–ç (n) = (n << 1) ^ (n >> 31)  // 32ä½
ZigZagç¼–ç (n) = (n << 1) ^ (n >> 63)  // 64ä½
```

**ç¤ºä¾‹ï¼š**

```
å€¼ï¼š-1
ZigZagç¼–ç ï¼š1
Varintç¼–ç ï¼š01
```

```
å€¼ï¼š-2
ZigZagç¼–ç ï¼š3
Varintç¼–ç ï¼š03
```

### 3. bool

**Wire Typeï¼š0ï¼ˆVarintï¼‰**

```
false â†’ 00
true  â†’ 01
```

**ç¤ºä¾‹ï¼š**

```
å­—æ®µå®šä¹‰ï¼šbool is_active = 1;
å€¼ï¼štrue

ç¼–ç ï¼š
  å­—æ®µæ ‡è®°ï¼š08 (å­—æ®µ1, WireType=0)
  å€¼ï¼š01 (true)
  ç»“æœï¼š08 01
```

### 4. enum

**Wire Typeï¼š0ï¼ˆVarintï¼‰**

ç¼–ç ä¸º Varint æ•´æ•°ã€‚

**ç¤ºä¾‹ï¼š**

```
enum Status {
    UNKNOWN = 0;
    ACTIVE = 1;
    INACTIVE = 2;
}

å­—æ®µå®šä¹‰ï¼šStatus status = 1;
å€¼ï¼šACTIVE (1)

ç¼–ç ï¼š
  å­—æ®µæ ‡è®°ï¼š08 (å­—æ®µ1, WireType=0)
  å€¼ï¼š01 (Varintç¼–ç çš„1)
  ç»“æœï¼š08 01
```

### 5. fixed32 / sfixed32

**Wire Typeï¼š5ï¼ˆFixed32ï¼‰**

å›ºå®š4å­—èŠ‚ï¼Œå°ç«¯åºã€‚

```
ç¼–ç æ ¼å¼ï¼š[å­—æ®µæ ‡è®°] [4å­—èŠ‚å›ºå®šå€¼]
```

**ç¤ºä¾‹ï¼š**

```
å­—æ®µå®šä¹‰ï¼šfixed32 value = 1;
å€¼ï¼š0x12345678

ç¼–ç ï¼š
  å­—æ®µæ ‡è®°ï¼š0D (å­—æ®µ1, WireType=5)
  å€¼ï¼š78 56 34 12 (å°ç«¯åº)
  ç»“æœï¼š0D 78 56 34 12
```

### 6. fixed64 / sfixed64

**Wire Typeï¼š1ï¼ˆFixed64ï¼‰**

å›ºå®š8å­—èŠ‚ï¼Œå°ç«¯åºã€‚

```
ç¼–ç æ ¼å¼ï¼š[å­—æ®µæ ‡è®°] [8å­—èŠ‚å›ºå®šå€¼]
```

### 7. float

**Wire Typeï¼š5ï¼ˆFixed32ï¼‰**

IEEE 754 å•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œ4å­—èŠ‚ï¼Œå°ç«¯åºã€‚

**ç¤ºä¾‹ï¼š**

```
å­—æ®µå®šä¹‰ï¼šfloat value = 1;
å€¼ï¼š1.5

ç¼–ç ï¼š
  å­—æ®µæ ‡è®°ï¼š0D (å­—æ®µ1, WireType=5)
  å€¼ï¼š00 00 C0 3F (IEEE 754, å°ç«¯åº)
  ç»“æœï¼š0D 00 00 C0 3F
```

### 8. double

**Wire Typeï¼š1ï¼ˆFixed64ï¼‰**

IEEE 754 åŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œ8å­—èŠ‚ï¼Œå°ç«¯åºã€‚

### 9. string / bytes

**Wire Typeï¼š2ï¼ˆLength-Delimitedï¼‰**

```
ç¼–ç æ ¼å¼ï¼š[å­—æ®µæ ‡è®°] [é•¿åº¦(Varint)] [æ•°æ®]
```

**ç¤ºä¾‹ï¼š**

```
å­—æ®µå®šä¹‰ï¼šstring name = 1;
å€¼ï¼š"hello"

ç¼–ç ï¼š
  å­—æ®µæ ‡è®°ï¼š0A (å­—æ®µ1, WireType=2)
  é•¿åº¦ï¼š05 (Varintç¼–ç çš„5)
  æ•°æ®ï¼š68 65 6C 6C 6F ("hello"çš„UTF-8ç¼–ç )
  ç»“æœï¼š0A 05 68 65 6C 6C 6F
```

### 10. embedded messageï¼ˆåµŒå¥—æ¶ˆæ¯ï¼‰

**Wire Typeï¼š2ï¼ˆLength-Delimitedï¼‰**

```
ç¼–ç æ ¼å¼ï¼š[å­—æ®µæ ‡è®°] [é•¿åº¦(Varint)] [æ¶ˆæ¯å†…å®¹]
```

**ç¤ºä¾‹ï¼š**

```
message Person {
    int32 id = 1;
    string name = 2;
}

å­—æ®µå®šä¹‰ï¼šPerson person = 1;
å€¼ï¼š{id: 1, name: "Alice"}

ç¼–ç ï¼š
  å­—æ®µæ ‡è®°ï¼š0A (å­—æ®µ1, WireType=2)
  é•¿åº¦ï¼š07 (Varintç¼–ç çš„7)
  æ¶ˆæ¯å†…å®¹ï¼š
    08 01 (id=1)
    12 05 41 6C 69 63 65 (name="Alice")
  ç»“æœï¼š0A 07 08 01 12 05 41 6C 69 63 65
```

### 11. repeatedï¼ˆé‡å¤å­—æ®µï¼‰

#### é packed æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰

æ¯ä¸ªå…ƒç´ å•ç‹¬ç¼–ç ã€‚

```
å­—æ®µå®šä¹‰ï¼šrepeated int32 numbers = 1;
å€¼ï¼š[1, 2, 3]

ç¼–ç ï¼š
  08 01 (ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š1)
  08 02 (ç¬¬äºŒä¸ªå…ƒç´ ï¼š2)
  08 03 (ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼š3)
  ç»“æœï¼š08 01 08 02 08 03
```

#### packed æ¨¡å¼ï¼ˆä½¿ç”¨ [packed=true]ï¼‰

æ‰€æœ‰å…ƒç´ æ‰“åŒ…åœ¨ä¸€èµ·ã€‚

```
å­—æ®µå®šä¹‰ï¼šrepeated int32 numbers = 1 [packed=true];
å€¼ï¼š[1, 2, 3]

ç¼–ç ï¼š
  å­—æ®µæ ‡è®°ï¼š0A (å­—æ®µ1, WireType=2)
  é•¿åº¦ï¼š03 (Varintç¼–ç çš„3)
  æ•°æ®ï¼š01 02 03 (æ‰€æœ‰å€¼è¿ç»­å­˜å‚¨)
  ç»“æœï¼š0A 03 01 02 03
```

---

## é•¿åº¦å‰ç¼€ç¼–ç 

### PrefixStyle.Fixed32

å›ºå®š4å­—èŠ‚é•¿åº¦å‰ç¼€ï¼Œå°ç«¯åºã€‚

```
ç¼–ç æ ¼å¼ï¼š[4å­—èŠ‚é•¿åº¦] [æ•°æ®]
```

**ç¤ºä¾‹ï¼š**

```
æ•°æ®ï¼š"hello" (5å­—èŠ‚)

ç¼–ç ï¼š
  é•¿åº¦ï¼š05 00 00 00 (å°ç«¯åºï¼Œ4å­—èŠ‚)
  æ•°æ®ï¼š68 65 6C 6C 6F
  ç»“æœï¼š05 00 00 00 68 65 6C 6C 6F
```

### PrefixStyle.Base128ï¼ˆVarintï¼‰

ä½¿ç”¨ Varint ç¼–ç çš„é•¿åº¦å‰ç¼€ã€‚

```
ç¼–ç æ ¼å¼ï¼š[é•¿åº¦(Varint)] [æ•°æ®]
```

**ç¤ºä¾‹ï¼š**

```
æ•°æ®ï¼š"hello" (5å­—èŠ‚)

ç¼–ç ï¼š
  é•¿åº¦ï¼š05 (Varintç¼–ç çš„5)
  æ•°æ®ï¼š68 65 6C 6C 6F
  ç»“æœï¼š05 68 65 6C 6C 6F
```

---

## å®é™…ç¼–ç ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå¿ƒè·³åŒ…æ¶ˆæ¯åŒ…å¤´

```csharp
CSPacketHeader {
    Id = 1;
    PacketLength = 4;
}
```

**ç¼–ç è¿‡ç¨‹ï¼š**

1. **å­—æ®µ1ï¼ˆIdï¼‰ï¼š**
   - å­—æ®µæ ‡è®°ï¼š`(1 << 3) | 0 = 0x08`
   - å€¼ï¼š`1` â†’ Varintç¼–ç ï¼š`0x01`
   - ç¼–ç ï¼š`08 01`

2. **å­—æ®µ2ï¼ˆPacketLengthï¼‰ï¼š**
   - å­—æ®µæ ‡è®°ï¼š`(2 << 3) | 0 = 0x10`
   - å€¼ï¼š`4` â†’ Varintç¼–ç ï¼š`0x04`
   - ç¼–ç ï¼š`10 04`

**å®Œæ•´ç¼–ç ï¼š** `08 01 10 04`ï¼ˆ4å­—èŠ‚ï¼‰

### ç¤ºä¾‹2ï¼šå¿ƒè·³åŒ…æ¶ˆæ¯åŒ…ä½“

```csharp
CSHeartBeat {
    // ç©ºç±»ï¼Œæ— å­—æ®µ
}
```

**ä½¿ç”¨ SerializeWithLengthPrefix(..., PrefixStyle.Fixed32)ï¼š**

1. **Fixed32é•¿åº¦å‰ç¼€ï¼š**
   - å®é™…åŒ…ä½“é•¿åº¦ï¼š`0`å­—èŠ‚
   - é•¿åº¦å‰ç¼€ï¼š`00 00 00 00`ï¼ˆå°ç«¯åºï¼Œ4å­—èŠ‚ï¼‰

2. **å®é™…åŒ…ä½“ï¼š**
   - ç©ºï¼ˆ0å­—èŠ‚ï¼‰

**å®Œæ•´ç¼–ç ï¼š** `00 00 00 00`ï¼ˆ4å­—èŠ‚ï¼‰

### ç¤ºä¾‹3ï¼šå®Œæ•´å¿ƒè·³åŒ…

```
æ¶ˆæ¯åŒ…å¤´ï¼š08 01 10 04
æ¶ˆæ¯åŒ…ä½“ï¼š00 00 00 00
å®Œæ•´æ¶ˆæ¯ï¼š08 01 10 04 00 00 00 00ï¼ˆ8å­—èŠ‚ï¼‰
```

### ç¤ºä¾‹4ï¼šå¸¦å­—ç¬¦ä¸²çš„æ¶ˆæ¯

```csharp
message LoginRequest {
    string username = 1;
    string password = 2;
}

å€¼ï¼š{
    username: "alice",
    password: "secret123"
}
```

**ç¼–ç è¿‡ç¨‹ï¼š**

1. **å­—æ®µ1ï¼ˆusernameï¼‰ï¼š**
   - å­—æ®µæ ‡è®°ï¼š`0A` (å­—æ®µ1, WireType=2)
   - é•¿åº¦ï¼š`05` (Varintç¼–ç çš„5)
   - æ•°æ®ï¼š`61 6C 69 63 65` ("alice"çš„UTF-8)
   - ç¼–ç ï¼š`0A 05 61 6C 69 63 65`

2. **å­—æ®µ2ï¼ˆpasswordï¼‰ï¼š**
   - å­—æ®µæ ‡è®°ï¼š`12` (å­—æ®µ2, WireType=2)
   - é•¿åº¦ï¼š`09` (Varintç¼–ç çš„9)
   - æ•°æ®ï¼š`73 65 63 72 65 74 31 32 33` ("secret123"çš„UTF-8)
   - ç¼–ç ï¼š`12 09 73 65 63 72 65 74 31 32 33`

**å®Œæ•´ç¼–ç ï¼š** `0A 05 61 6C 69 63 65 12 09 73 65 63 72 65 74 31 32 33`

---

## ç¼–ç è§„åˆ™æ€»ç»“

### 1. å­—æ®µé¡ºåº

- å­—æ®µå¯ä»¥æŒ‰**ä»»æ„é¡ºåº**ç¼–ç 
- æ¥æ”¶æ–¹å¿…é¡»èƒ½å¤Ÿå¤„ç†ä»»æ„é¡ºåºçš„å­—æ®µ

### 2. é»˜è®¤å€¼

- å¦‚æœå­—æ®µå€¼ä¸º**é»˜è®¤å€¼**ï¼Œå¯ä»¥é€‰æ‹©ä¸ç¼–ç ï¼ˆèŠ‚çœç©ºé—´ï¼‰
- æ¥æ”¶æ–¹ä¼šå°†ç¼ºå¤±çš„å­—æ®µè§†ä¸ºé»˜è®¤å€¼

**é»˜è®¤å€¼ï¼š**
- `int32/int64`ï¼š0
- `float/double`ï¼š0.0
- `bool`ï¼šfalse
- `string/bytes`ï¼šç©ºå­—ç¬¦ä¸²
- `enum`ï¼šç¬¬ä¸€ä¸ªå€¼ï¼ˆé€šå¸¸æ˜¯0ï¼‰
- `message`ï¼šnull

### 3. å­—æ®µå·è§„åˆ™

- å­—æ®µå·èŒƒå›´ï¼š**1 åˆ° 536870911**ï¼ˆ2^29 - 1ï¼‰
- å­—æ®µå· **19000-19999** ä¿ç•™ç»™ ProtoBuf å†…éƒ¨ä½¿ç”¨
- å­—æ®µå· **1-15** ä½¿ç”¨1å­—èŠ‚å­—æ®µæ ‡è®°ï¼ˆæ¨èç”¨äºå¸¸ç”¨å­—æ®µï¼‰

### 4. å¯é€‰å­—æ®µ vs å¿…éœ€å­—æ®µ

- ProtoBuf 3 ä¸­ï¼Œæ‰€æœ‰å­—æ®µéƒ½æ˜¯**å¯é€‰çš„**
- å­—æ®µå¯ä»¥ç¼ºå¤±ï¼Œæ¥æ”¶æ–¹ä½¿ç”¨é»˜è®¤å€¼

### 5. æœªçŸ¥å­—æ®µ

- æ¥æ”¶æ–¹ä¼š**ä¿ç•™æœªçŸ¥å­—æ®µ**ï¼Œåœ¨åºåˆ—åŒ–æ—¶é‡æ–°è¾“å‡º
- è¿™ä¿è¯äº†å‘åå…¼å®¹æ€§

### 6. ç¼–ç ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨å­—æ®µå· 1-15**ï¼šå­—æ®µæ ‡è®°åªéœ€1å­—èŠ‚
2. **ä½¿ç”¨ packed repeated**ï¼šå¯¹äºæ•°å€¼ç±»å‹çš„é‡å¤å­—æ®µï¼Œä½¿ç”¨ `[packed=true]`
3. **ä½¿ç”¨ sint32/sint64**ï¼šå¯¹äºå¯èƒ½æœ‰è´Ÿæ•°çš„å­—æ®µï¼Œä½¿ç”¨ ZigZag ç¼–ç 
4. **é¿å…é¢‘ç¹ä½¿ç”¨ fixed32/fixed64**ï¼šåªåœ¨å€¼å¾ˆå¤§æ—¶ä½¿ç”¨ï¼ˆ>2^28ï¼‰

---

## å·¥å…·å’Œè°ƒè¯•

### æŸ¥çœ‹ç¼–ç ç»“æœ

#### C# ä»£ç ç¤ºä¾‹

```csharp
using ProtoBuf;
using System;
using System.IO;

// åºåˆ—åŒ–å¹¶æŸ¥çœ‹åå…­è¿›åˆ¶
var obj = new YourMessage { Id = 1, Name = "test" };
using (var ms = new MemoryStream())
{
    Serializer.Serialize(ms, obj);
    byte[] data = ms.ToArray();
    Console.WriteLine(BitConverter.ToString(data));
}
```

#### åœ¨çº¿å·¥å…·

- **Protobuf Decoder**ï¼šhttps://protobuf-decoder.netlify.app/
- **Protobuf Inspector**ï¼šChrome æ‰©å±•

### å¸¸è§é—®é¢˜

1. **ä¸ºä»€ä¹ˆæˆ‘çš„æ¶ˆæ¯æ¯”é¢„æœŸå¤§ï¼Ÿ**
   - æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº† packed repeated
   - æ£€æŸ¥å­—æ®µå·æ˜¯å¦åœ¨ 1-15 èŒƒå›´å†…
   - æ£€æŸ¥æ˜¯å¦æœ‰ä¸å¿…è¦çš„åµŒå¥—æ¶ˆæ¯

2. **ä¸ºä»€ä¹ˆååºåˆ—åŒ–å¤±è´¥ï¼Ÿ**
   - æ£€æŸ¥å­—æ®µå·æ˜¯å¦åŒ¹é…
   - æ£€æŸ¥ WireType æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥æ•°æ®æ˜¯å¦å®Œæ•´

3. **å¦‚ä½•ä¼˜åŒ–æ¶ˆæ¯å¤§å°ï¼Ÿ**
   - ä½¿ç”¨å­—æ®µå· 1-15
   - ä½¿ç”¨ packed repeated
   - é¿å…ä¸å¿…è¦çš„åµŒå¥—

---

## å‚è€ƒèµ„æ–™

- [Protocol Buffers å®˜æ–¹æ–‡æ¡£](https://developers.google.com/protocol-buffers)
- [ProtoBuf ç¼–ç è§„èŒƒ](https://developers.google.com/protocol-buffers/docs/encoding)
- [Varint ç¼–ç è¯¦è§£](https://developers.google.com/protocol-buffers/docs/encoding#varints)

---

## é™„å½•ï¼šå¿«é€Ÿå‚è€ƒè¡¨

### WireType è¡¨

| WireType | å€¼ | ç±»å‹ |
|----------|-----|------|
| Varint | 0 | int32, int64, uint32, uint64, bool, enum, sint32, sint64 |
| Fixed64 | 1 | double, fixed64, sfixed64 |
| Length-Delimited | 2 | string, bytes, embedded messages, packed repeated |
| Fixed32 | 5 | float, fixed32, sfixed32 |

### å­—æ®µæ ‡è®°è®¡ç®—

```
å­—æ®µæ ‡è®° = (å­—æ®µå· << 3) | WireType
```

### Varint ç¼–ç èŒƒå›´

| å­—èŠ‚æ•° | å€¼èŒƒå›´ |
|--------|--------|
| 1å­—èŠ‚ | 0 - 127 |
| 2å­—èŠ‚ | 128 - 16383 |
| 3å­—èŠ‚ | 16384 - 2097151 |
| 4å­—èŠ‚ | 2097152 - 268435455 |
| 5å­—èŠ‚ | 268435456 - 34359738367 |

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0  
**æœ€åæ›´æ–°ï¼š** 2024å¹´

